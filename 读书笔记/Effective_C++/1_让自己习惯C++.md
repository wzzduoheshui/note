# ğŸEffective C++

---

## ğŸš—è®©è‡ªå·±ä¹ æƒ¯C++

---

### ğŸ‘‰æ¡æ¬¾01ï¼šè§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦

> **C++é«˜æ•ˆç¼–ç¨‹å®ˆåˆ™è§†çŠ¶å†µè€Œå˜åŒ–ï¼Œè¿™å–å†³äºä½ ä½¿ç”¨C++çš„å“ªä¸€éƒ¨åˆ†**

* **`C`**

  è¿™éƒ¨åˆ†ä¸»è¦æ˜¯è¯´`C++`ä¾æ—§æ˜¯ä»¥`C`è¯­è¨€ä¸ºåŸºç¡€ï¼Œå…¶ä¸­çš„é¢„å¤„ç†å™¨ã€æ•°ç»„ã€å†…ç½®æ•°æ®ç±»å‹ã€æŒ‡é’ˆç­‰ç»Ÿç»Ÿæ¥è‡ªäº`C`ã€‚ä½†æ˜¯å¯¹äº`C`æ¥ä¹¦ä¾æ—§æœ‰ä»–çš„å±€é™ï¼Œæ²¡æœ‰æ¨¡æ¿ï¼Œæ²¡æœ‰é‡è½½ï¼Œæ²¡æœ‰ç¼ºçœâ€¦â€¦

* **`Object-Oriented C++`**

  è¿™éƒ¨åˆ†ä¸»è¦æ˜¯å®Œæˆäº†é¢å‘å¯¹è±¡æ–¹å‘çš„è¯‰æ±‚ï¼Œå³æ„é€ ã€ææ„ã€å°è£…ã€ç»§æ‰¿ã€å¤šæ€â€¦â€¦

* **`Template C++`**

  è¿™éƒ¨åˆ†æ˜¯`C++`çš„æ³›å‹ç¼–ç¨‹éƒ¨åˆ†ï¼Œå› ä¸ºæ¨¡æ¿çš„å‡ºç°ï¼Œä¾¿æ·äº†å¾ˆå¤šå·¥ä½œï¼Œ`STL`ä¹Ÿä¾¿åº”è¿è€Œç”Ÿ

* **`STL`**

  `STL`æ˜¯ä¸€ä¸ª`template`ç¨‹åºåº“ï¼Œä»–åŒ…æ‹¬äº†å®¹å™¨ã€ç®—æ³•ã€è¿­ä»£å™¨ã€ä»¿å‡½æ•°ã€ç©ºé—´é…ç½®å™¨ã€é…æ¥å™¨ã€‚è‹¥æƒ³æ›´å¥½çš„ä½¿ç”¨`STL`ï¼Œä½ å¿…é¡»éµå®ˆä»–çš„è§„åˆ™

---

### ğŸ‘‰æ¡æ¬¾02ï¼šå°½é‡ä»¥`const`,`enum`,`inline`æ›¿æ¢`#define`

> è®°ä½ä¸€ç‚¹**å®å¯ä»¥ç¼–è¯‘å™¨æ›¿æ¢é¢„å¤„ç†å™¨** 

```c
#define ASPECT_RATIO 1.653
```

å…³äºè¿™ä¸ªä¹Ÿè®¸åœ¨ç¼–è¯‘å™¨è¿˜æ²¡å¼€å§‹å¤„ç†æºç å‰å°±è¢«é¢„å¤„ç†å™¨ç§»èµ°äº†ï¼Œ`ASPECT_RATIO`ä¹Ÿè®¸å¹¶æœªè¢«ç¼–è¯‘å™¨çœ‹è§ï¼Œè¿™ä¸ªåç§°å¯èƒ½å¹¶æœªè¿›å…¥ç¬¦å·è¡¨ã€‚

å¹¶ä¸”ï¼Œå¦‚æœç¼–è¯‘å™¨ç›²ç›®çš„è¿›è¡Œå®æ›¿æ¢ï¼Œå¯èƒ½å¯¼è‡´ç›®æ ‡ç å‡ºç°å¤šä»½çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š

```cpp 
#define VERSION 1.34

int main() {
    int version1 = VERSION;
    int version2 = VERSION;
}

// é¢„å¤„ç†é˜¶æ®µç»è¿‡å®æ›¿æ¢ä»¥å

int main() {
    int version1 = 1.34;
    int version2 = 1.34;
}
```

---

#### **ğŸ”¸ä»¥å¸¸é‡æ›¿æ¢å®**

```c
const double AspectRatio = 1.653;
```

* å› ä¸ºä½œä¸ºä¸€ä¸ªè¯­è¨€å¸¸é‡ï¼ŒAspectRatioä¸€å®šæ˜¯ä¼šè¿›å…¥ç¬¦å·è¡¨çš„ï¼Œ

* å¹¶ä¸”ä¹Ÿä¸ä¼šé€ æˆå¤šä»½ç›®æ ‡ç çš„é—®é¢˜

ä½†æ˜¯æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

> å®šä¹‰å¸¸é‡æŒ‡é’ˆçš„æ—¶å€™ï¼Œé¿å…é€ æˆé€šè¿‡æŒ‡é’ˆçš„æ¶æ„ä¿®æ”¹ï¼ˆå…³äºè¿™ä¸ªéšåä¼šå•ç‹¬è¯´ï¼‰

---

####  **ğŸ”¸`class`å†…ä¸“å±å¸¸é‡é‡‡ç”¨"in-classåˆå€¼è®¾å®š"**

"in-classåˆå€¼è®¾å®š"çš„æ¡ä»¶

> é€šå¸¸C++è¦æ±‚å¯¹æ¯ä¸€ä¸ªä½¿ç”¨çš„ä¸œè¥¿éƒ½è¦æœ‰å®šä¹‰ï¼Œä½†æ˜¯ä»¥ä¸‹æƒ…å†µä¾‹å¤–ï¼š
>
> 1. å¦‚æœæ˜¯`class`ä¸“å±å¸¸é‡
> 2. æ˜¯æ•´æ•°ç±»å‹ï¼ˆä¾‹å¦‚`ints`ï¼Œ`chars`ï¼Œ`bools`ï¼‰

å…³äºclasså†…ä¸“å±å¸¸é‡

>   1. é¦–å…ˆä¸ºäº†é™åˆ¶ä½œç”¨åŸŸï¼Œå¿…é¡»å°†å…¶æ”¾åœ¨`class`å†…æˆä¸ºä¸€å`class`çš„æˆå‘˜
>   2. å…¶æ¬¡ä¸ºäº†ç¡®ä¿å¸¸é‡è‡³å¤šåªæœ‰ä¸€ä»½å®ä½“ï¼Œå¿…é¡»è®©ä»–ç§°ä¸º`static`æˆå‘˜

```cpp
class A
{
private:
	static const int number = 1;
    int _a[number];
};
```

* ä½†æ˜¯å¯¹äºè¿™ä¸ªAè¿™ä¸ªç±»æ¥è¯´`static const int number = 1;`æ˜¯`number`çš„å£°æ˜è€Œéå®šä¹‰ã€‚

* äº‹å®è¯æ˜åªè¦ä¸å–`number`çš„åœ°å€ï¼Œå¯ä»¥åªé‡‡å–å£°æ˜è€Œä¸éœ€è¦å®šä¹‰ã€‚ï¼ˆå¹¶ä¸”`number`å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼‰

  > ä»¥ä¸‹æ˜¯å®è·µè¿‡ç¨‹:
  >
  > ```cpp
  > // test.h
  > #include <iostream>
  > #include <string>
  > 
  > class A {
  > public:
  > 	void print()
  > 	{
  >         	std::cout << number << std::endl;// å¯ä»¥æ­£å¸¸è¿è¡Œ
  > 
  > 		// const int* p = &number;
  > 		// std::cout << p << std::endl;// æ— æ³•æ­£å¸¸è¿è¡Œ
  > 	}
  > private:
  > 	static const int number = 5;
  > 	int _a[number];
  > };
  > 
  > /************************************************************************/
  > // main.cpp
  > #include "test.h"
  > 
  > int main()
  > {
  > 	A a1;
  > 	A a2;
  > 
  >     	std::cout << sizeof(a1) << std::endl;
  >     	std::cout << sizeof(a2) << std::endl;
  > 
  > 	a1.print();
  > 	a2.print();
  > 
  >    	return 0;
  > }
  > ```
  >
  > ![ka](https://dhrs-oss.oss-cn-beijing.aliyuncs.com/img/safsafadofa.png)

* å¦‚æœå¿…é¡»è¦å–åˆ°`number`çš„åœ°å€ï¼Œæˆ–è€…æ˜¯ç¼–è¯‘å™¨åšæŒéœ€è¦å®šä¹‰`number`ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»»æ„ä¸€ä¸ª`.cpp`æ–‡ä»¶ä¸­å¯¹`number`è¿›è¡Œå®šä¹‰ã€‚

  ```cpp
  // main.cpp
  const int A::number;// numberçš„å®šä¹‰
  ```

  > **åœ¨å®šä¹‰å¼ä¸­æˆ‘ä»¬ä¸éœ€è¦å¯¹`number`è¿›è¡Œèµ‹å€¼**ï¼Œå› ä¸ºåœ¨`number`çš„å£°æ˜ä¸­å°±å·²ç»ç»™äºˆäº†`number`åˆå€¼ï¼Œè€Œ`number`æ˜¯`const`å†æ¬¡èµ‹å€¼ä¼šæŠ¥é”™ã€‚
  >
  > 
  >
  > **å®šä¹‰å¼éœ€è¦æ”¾åœ¨ä»»æ„ä¸€ä¸ª.cppï¼ˆå®ç°æ–‡ä»¶/æºæ–‡ä»¶ï¼‰ä¸­**ï¼Œè¿™ä¸ªåŸå› è§ä¸‹ï¼š
  >
  > > 1. å¦‚æœæ”¾åœ¨`.h`ï¼ˆå¤´æ–‡ä»¶ï¼‰ä¸­ï¼Œæ”¾åœ¨`class A{};`å£°æ˜ä¹‹å‰ï¼Œä¼šç”±äº`class A`æœªè¢«å£°æ˜è€ŒæŠ¥é”™
  > > 2. å¦‚æœæ”¾åœ¨`.h`ï¼ˆå¤´æ–‡ä»¶ï¼‰ä¸­ï¼Œæ”¾åœ¨`class A{};`å£°æ˜ä¹‹åï¼Œå¦‚æœæ­¤æ—¶é¡¹ç›®å†…æœ‰å¤šä¸ª`.cpp`æ–‡ä»¶åŒ…å«äº†è¯¥å¤´æ–‡ä»¶ï¼Œåœ¨é¢„å¤„ç†é˜¶æ®µå¤´æ–‡ä»¶ä¼šè¢«å±•å¼€ï¼Œå°±ä¼šå‡ºç°é‡å®šä¹‰çš„ç°è±¡è¿›è€ŒæŠ¥é”™
  > >    ï¼ˆè¿™é‡Œæˆ‘è”æƒ³åˆ°äº†å¤´æ–‡ä»¶ä¸­çš„`extern`ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯`extern`åé¢è·Ÿçš„æ—¶å£°æ˜è€Œéå®šä¹‰ï¼‰

* å€¼å¾—æ³¨æ„çš„æ˜¯å°½ç®¡`const`å¦‚æ­¤éº»çƒ¦ï¼Œä½†æ˜¯`#define`æ— æ³•åˆ›å»ºä¸€ä¸ª`class`ä¸“å±å¸¸é‡ã€‚å®ä¸€æ—¦è¢«å®šä¹‰å°±åœ¨å…¶åçš„ç¼–è¯‘è¿‡ç¨‹ä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°åœ¨æŸå¤„é‡è§äº†`#undef`ã€‚ä¹Ÿæ­£å¦‚æ­¤`#define`ä¹Ÿæ— æ³•æä¾›ä»»ä½•å°è£…æ€§

* **"in-classåˆå€¼è®¾å®š"ä¹Ÿæœ‰ç¼ºç‚¹**

  > * æœ‰äº›ç¼–è¯‘å™¨ä¸å…è®¸`static`æˆå‘˜åœ¨å£°æ˜æ—¶è¿›è¡Œèµ‹å€¼
  > * æ‰€è°“çš„"in-classåˆå€¼è®¾å®š"ä¹Ÿåªå…è®¸å¯¹æ•´æ•°å¸¸é‡è¿›è¡Œèµ‹å€¼
  >
  > 
  >
  > * å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å®šä¹‰å¼ä¸­å¯¹éœ€è¦çš„`class`å¸¸é‡è¿›è¡Œèµ‹å€¼ï¼ˆå®šä¹‰å¼å½“ç„¶æ˜¯è¦æ”¾åˆ°ä»»æ„ä¸€ä¸ª`.cpp`å®ç°æ–‡ä»¶ä¸­ï¼‰
  >
  > > ```cpp
  > > // test.h
  > > class A {
  > > public:
  > > 	void print()
  > > 	{
  > >         std::cout << "number : " << number << std::endl;
  > > 
  > > 		const int* p = &number;
  > > 		std::cout << p << std::endl;
  > > 	}
  > > private:
  > > 	static const int number;
  > > };
  > > 
  > > /**********************************************************************/
  > > // main.cpp
  > > const int A::number = 5;
  > > 
  > > int main()
  > > {
  > > 	A a1;
  > > 	A a2;
  > > 
  > > 	a1.print();
  > > 	a2.print();
  > > 
  > >     return 0;
  > > }
  > > ```
  > >
  > > ![image-20231125172831534](https://dhrs-oss.oss-cn-beijing.aliyuncs.com/img/202311251728600.png)
  >
  > ä½†æ˜¯ä¸å¯é¿å…çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨è¿™ä¸ª`number`ä¾æ—§ä¼šæŠ¥é”™ï¼ˆå› ä¸ºç¼–è¯‘å™¨åšæŒè¦åœ¨ç¼–è¯‘æœŸé—´å°±çŸ¥é“æ•°ç»„çš„å¤§å°ï¼Œè§ä¸Šè¿°ä¸¾ä¾‹ï¼‰

---

#### **ğŸ”¸é‡‡ç”¨â€œthe enum hackâ€è¡¥å¿constæ— æ³•ä½¿ç”¨**

> "the enum hack"çš„ç†è®ºåŸºç¡€æ˜¯ï¼šâ€œä¸€ä¸ªå±äºæšä¸¾ç±»å‹ï¼ˆenumerated typeï¼‰çš„æ•°å€¼å¯æƒå……`ints`è¢«ä½¿ç”¨â€

äºæ˜¯å°±å‡ºç°äº†ä»¥ä¸‹å†™æ³•

```cpp
// test.h
class A {
public:
	void print()
	{
        std::cout << "number : " << number << std::endl;

		// const int* p = &number;
		// std::cout << p << std::endl;// å–ä¸€ä¸ªenumçš„åœ°å€æ˜¯ä¸åˆæ³•çš„
	}
private:
	enum { number = 5 };// "the enum hack"-ä»¤numberæˆä¸º5çš„ä¸€ä¸ªè®°å·åç§°
	int _a[number];
};

/***************************************************************************/

// main.cpp
int main()
{
	A a1;
	A a2;

    tes();

    std::cout << "sizeof(a1) : " << sizeof(a1) << std::endl;
    std::cout << "sizeof(a2) : " << sizeof(a2) << std::endl;

	a1.print();
	a2.print();

    return 0;
}
```

![image-20231125173055259](https://dhrs-oss.oss-cn-beijing.aliyuncs.com/img/202311251730333.png)

* "the enum hack"æœ‰æ•°ä¸ªç†ç”±å€¼å¾—æˆ‘ä»¬è®¤è¯†

  > 1. `enum hack`çš„è¡Œä¸ºæŸæ–¹é¢æ¯”è¾ƒåƒ`#define`è€Œä¸åƒ`const`ï¼Œå–`const`çš„åœ°å€æ˜¯åˆæ³•çš„ï¼Œè€Œå–`#define`å’Œ`enum`çš„åœ°å€æ˜¯ä¸åˆæ³•çš„
  > 2. `const`æœ‰æ—¶ä¼šä¸º"æ•´æ•°å‹constå¯¹è±¡"è®¾å®šå¦å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯`enum hack`å’Œ`#define`ä¸€æ ·ç»å¯¹ä¸ä¼šå¯¼è‡´éå¿…è¦çš„å†…å­˜åˆ†é…ï¼ˆè¿™é‡Œæ¿€èµ·äº†æˆ‘å¯¹`const`çš„å…´è¶£ï¼Œç•™ç»™ä¸‹æ¬¡å®Œæˆï¼‰

---

> å…³äº`#define`å®šä¹‰`å®å¸¸é‡`çš„è¯é¢˜æˆ‘ä»¬æˆªè‡³åœ¨è¿™é‡Œï¼Œæ¥ä¸‹æ¥è½¬å›åˆ°é¢„å¤„ç†å™¨æ¥çœ‹çœ‹å…³äº`#define`çš„`å®å‡½æ•°`

---

#### **ğŸ”¸`inlineå‡½æ•°`æ›¿æ¢`#define`**

> å®å‡½æ•°åªæ˜¯çœ‹èµ·æ¥åƒå‡½æ•°ï¼Œå®ç°äº†å‡½æ•°çš„ç›®çš„ï¼Œå¹¶ä¸”ä¸ä¼šå¯¼è‡´å‡½æ•°è°ƒç”¨é€ æˆçš„é¢å¤–å¼€é”€ã€‚äº‹å®çœŸçš„å¦‚æ­¤å—ï¼Ÿ

* æ„å¤–çš„å¢é•¿

  ```cpp
  #define WHO_IS_MAX(a, b) print((a) > (b) ? (a) : (b))
  ```

  å½“æˆ‘ä»¬æƒ³é€šè¿‡ä¸Šè¿°å®å»è°ƒç”¨printå»æ‰“å°æœ€å¤§å€¼çš„æ—¶å€™ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ

  ```cpp
  #define WHO_IS_MAX(a, b) print((a) > (b) ? (a) : (b))
  
  void print(int num)
  {
      std::cout << "print(int a) : " << num << std::endl;
  }
  
  int main()
  {
      int a = 1;
      int b = 5;
      std::cout << "WHO_IS_MAX(a,++b);" << std::endl; 
      WHO_IS_MAX(a,++b);
      std::cout << "a = " << a << std::endl; 
      std::cout << "b = " << b << std::endl;
  
      std::cout << std::endl;
  
      a = 1;
      b = 5;
      std::cout << "WHO_IS_MAX(a + 10, ++b);" << std::endl;     
      WHO_IS_MAX(a + 10, ++b);
      std::cout << "a = " << a << std::endl; 
      std::cout << "b = " << b << std::endl;
      
      return 0;
  }
  ```

  ![image-20231125182538612](https://dhrs-oss.oss-cn-beijing.aliyuncs.com/img/202311251825681.png)
  
  **å¯ä»¥çœ‹åˆ°åœ¨å®ä¸­ä½¿ç”¨++ï¼Œåœ¨è°ƒç”¨printå‡½æ•°ä¹‹å‰ï¼Œbé€’å¢çš„æ¬¡æ•°ç«Ÿç„¶å–å†³äºbè¢«ç”¨æ¥å’Œè°æ¯”è¾ƒ**
  
* ç”¨`inlineå‡½æ•°`æ¥ä»£æ›¿å®

  > `inlineå‡½æ•°`æ˜¯å»ºè®®ç¼–è¯‘å™¨å°†è¿™ä¸ªå‡½æ•°å±•å¼€ä½¿ç”¨ï¼Œæ³¨æ„æ˜¯å»ºè®®ï¼Œå…·ä½“æ˜¯å¦å°†è¯¥å‡½æ•°å±•å¼€è¿˜æ˜¯å–å†³äºç¼–è¯‘å™¨

  ```cpp
  class A{
  public:
      template<typename T>
      void printMax(const T& a, const T& b)
      {
          print(a > b ? a : b);
      }
  
  private:
      template<typename T>
      void print(const T& num)
      {
          std::cout << "print(const T& num) = " << num << std::endl;
      }
  };
  
  int main()
  {
      int a = 1;
      int b = 5;
      A a1;
      a1.printMax(a, ++b);
      std::cout << "a = " << a << std::endl; 
      std::cout << "b = " << b << std::endl;
  
      std::cout << std::endl;
  
      a = 1;
      b = 5;
      a1.printMax(a + 10, ++b);
      std::cout << "a = " << a << std::endl; 
      std::cout << "b = " << b << std::endl;
  
      return 0;
  }
  ```

  ![image-20231125184508593](https://dhrs-oss.oss-cn-beijing.aliyuncs.com/img/202311251845692.png)

  å¯ä»¥çœ‹åˆ°`inlineå‡½æ•°`ä»£æ›¿`#define`çš„ä¼˜ç‚¹

  > 1. æˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒå®å‡½æ•°é€ æˆæ„å¤–å¢é•¿çš„æƒ…å†µ
  > 2. ç”±äº`printMax`æ˜¯ä¸€ä¸ªçœŸæ­£çš„å‡½æ•°ï¼Œä»–éµå®ˆä½œç”¨åŸŸå’Œè®¿é—®è§„åˆ™ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿè¿›ä¸€æ­¥å®ç°äº†â€œclasså†…çš„private inlineâ€å‡½æ•°ã€‚

---

#### ğŸŒŸæ¡æ¬¾02å°ç»“

> * å¯¹äºå•çº¯çš„å¸¸é‡ï¼Œæœ€å¥½ç”¨constå¯¹è±¡æˆ–è€…enumsæ›¿æ¢#defines
> * å¯¹äºå½¢ä¼¼å‡½æ•°çš„å®ï¼Œæœ€å¥½æ”¹ç”¨inlineå‡½æ•°æ›¿æ¢#definesï¼Œæœ‰æ—¶ä¼šå‘ç°æ„æƒ³ä¸åˆ°çš„æƒŠå–œ

---

### ğŸ‘‰æ¡æ¬¾03ï¼š
